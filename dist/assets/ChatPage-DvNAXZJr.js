const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ContactsList-J3_No69Z.js","assets/index-CPVvppRK.js","assets/mui-core-hP9lAPsz.js","assets/router-CfdosDU_.js","assets/react-core-Bfr4Vjs6.js","assets/emotion-C3f8BbQd.js","assets/index-DmockKkT.css","assets/firebase-firestore-_jyfTNsQ.js","assets/firebase-auth-Dy6ffJkg.js","assets/firebase-3hue6fpD.js","assets/firebase-storage-BIx4hGas.js","assets/VoiceRecorder-K-mZTToY.js","assets/VoiceMessage-cqoQetY3.js"])))=>i.map(i=>d[i]);
import{u as e,a as t,j as r,_ as n}from"./index-CPVvppRK.js";import{r as i,u as a,a as o}from"./router-CfdosDU_.js";import{a as s,d as l,s as d}from"./firebase-3hue6fpD.js";import{c,q as p,o as u,a as g,d as f,u as x,w as m,g as y,b}from"./firebase-firestore-_jyfTNsQ.js";import{r as h,u as v,g as S}from"./firebase-storage-BIx4hGas.js";import"./mui-core-hP9lAPsz.js";import"./react-core-Bfr4Vjs6.js";import"./emotion-C3f8BbQd.js";import"./firebase-auth-Dy6ffJkg.js";var w=Object.defineProperty,k=Object.getOwnPropertySymbols,E=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable,z=(e,t,r)=>t in e?w(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,I=(e,t)=>{for(var r in t||(t={}))E.call(t,r)&&z(e,r,t[r]);if(k)for(var r of k(t))D.call(t,r)&&z(e,r,t[r]);return e},R=(e,t,r)=>new Promise((n,i)=>{var a=e=>{try{s(r.next(e))}catch(t){i(t)}},o=e=>{try{s(r.throw(e))}catch(t){i(t)}},s=e=>e.done?n(e.value):Promise.resolve(e.value).then(a,o);s((r=r.apply(e,t)).next())});const C=i.lazy(()=>n(()=>import("./ContactsList-J3_No69Z.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),M=i.lazy(()=>n(()=>import("./VoiceRecorder-K-mZTToY.js"),__vite__mapDeps([11,1,2,3,4,5,6]))),j=i.lazy(()=>n(()=>import("./VoiceMessage-cqoQetY3.js"),__vite__mapDeps([12,1,2,3,4,5,6]))),O=({children:e})=>t(i.Suspense,{fallback:t("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"20px",color:"#fff",fontSize:"14px"},children:"Chargement..."}),children:e}),U=o.memo(C),L=o.memo(M),_=o.memo(j);function A(){var n;const o=a(),{showToast:w}=e(),{isMobile:k,getResponsiveValue:E,getResponsiveButtonSize:D}=(()=>{const{isMobile:e,isSmallScreen:t,windowWidth:r}=(()=>{const[e,t]=i.useState(!1),[r,n]=i.useState(!1),[a,o]=i.useState(!1),[s,l]=i.useState(0);return i.useEffect(()=>{const e=()=>{const e=window.innerWidth;l(e),t(e<=768),n(e>768&&e<=1024),o(e>1024)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),{isMobile:e,isTablet:r,isDesktop:a,windowWidth:s,isSmallScreen:s<=480,isMediumScreen:s>480&&s<=768,isLargeScreen:s>768}})();return{isMobile:e,isSmallScreen:t,windowWidth:r,getResponsiveValue:(t,r)=>e?t:r,getResponsivePadding:()=>t?"12px 16px":e?"16px 20px":"20px 24px",getResponsiveFontSize:(r,n,i)=>t?r:e?n||r:i||n||r,getResponsiveButtonSize:()=>t?{minHeight:"48px",padding:"14px 18px"}:e?{minHeight:"44px",padding:"12px 16px"}:{minHeight:"auto",padding:"12px 24px"},getResponsiveInputSize:()=>t?{minHeight:"48px",padding:"16px 18px",fontSize:"16px"}:e?{minHeight:"44px",padding:"12px 16px",fontSize:"16px"}:{minHeight:"auto",padding:"12px 16px",fontSize:"16px"}}})(),[z,C]=i.useState(!0),[M,_]=i.useState(null),[A,W]=i.useState([]),[H,T]=i.useState(""),[P,B]=i.useState(!1),[F,V]=i.useState(!1),[Y,K]=i.useState(!1),[N,$]=i.useState(null),[q,G]=i.useState(!1);((e,t=80,r=400)=>{const[n,a]=i.useState(0),o=(i.useRef(null),Math.ceil(r/t)),s=Math.floor(n/t),l=Math.min(s+o+1,e.length);e.slice(s,l),e.length,i.useCallback(e=>{a(e.target.scrollTop)},[])})(A,80,400),i.useEffect(()=>(C(!0),()=>{C(!1)}),[]);const J=i.useCallback(e=>R(null,null,function*(){if(s.currentUser&&z)try{const t=f(l,"users",s.currentUser.uid);yield x(t,{online:e,lastSeen:(new Date).toISOString()})}catch(t){}}),[z]),Q=i.useMemo(()=>s.onAuthStateChanged(e=>{z&&(e?J(!0):(o("/login"),w({message:"Connexion requise pour acc√©der au chat",severity:"warning"})))}),[o,w,J,z]);i.useEffect(()=>{const e=Q;return()=>{e&&e(),z&&J(!1)}},[Q,J,z]),i.useEffect(()=>()=>{N&&N()},[N]),i.useEffect(()=>()=>{C(!1),N&&N()},[N]);const X=i.useCallback(e=>{if(!e||!z)return;const t=c(l,"conversations",e,"messages"),r=p(t,u("timestamp","asc")),n=g(r,e=>{if(!z)return;const t=[];e.forEach(e=>{t.push(I({id:e.id},e.data()))}),W(t)},e=>{z&&w({message:"Erreur lors du chargement des messages",severity:"error"})});$(()=>n)},[w,z]),Z=i.useCallback(e=>R(null,null,function*(){if(z){N&&N(),_(e),W([]),V(!1),K(!1);try{const t=c(l,"conversations"),r=p(t,m("participants","array-contains",s.currentUser.email)),n=yield y(r);let i=null;if(n.forEach(t=>{const r=t.data();r.participants.includes(e.email)&&(i=I({id:t.id},r))}),!i){const r=yield b(t,{participants:[s.currentUser.email,e.email],createdAt:(new Date).toISOString(),lastMessageAt:(new Date).toISOString()});i={id:r.id}}X(i.id)}catch(t){if(!z)return;w({message:"Erreur lors de la s√©lection du contact",severity:"error"})}}}),[N,w,X,z]);i.useCallback(e=>R(null,null,function*(){if(z)try{const t=c(l,"conversations"),r=p(t,m("participants","array-contains",s.currentUser.email)),n=yield y(r);let i=null;if(n.forEach(t=>{t.data().participants.includes(e.email)&&(i=t.id)}),!i){const r=yield b(t,{participants:[s.currentUser.email,e.email],createdAt:(new Date).toISOString(),lastMessageAt:(new Date).toISOString()});i=r.id}_({id:e.id||null,email:e.email,displayName:e.displayName||e.email.split("@")[0],avatar:e.avatar||null,online:e.online||!1,lastSeen:e.lastSeen||null}),X(i)}catch(t){if(!z)return;w({message:"Erreur lors de l'ouverture de la conversation",severity:"error"})}}),[X,w,z]);const ee=e=>R(null,null,function*(){if(M&&H.trim()&&z){e.preventDefault(),B(!0);try{const e=c(l,"conversations"),t=p(e,m("participants","array-contains",s.currentUser.email)),r=yield y(t);let n=null;if(r.forEach(e=>{e.data().participants.includes(M.email)&&(n=e.id)}),n){const e=c(l,"conversations",n,"messages");yield b(e,{sender:s.currentUser.email,text:H.trim(),timestamp:(new Date).toISOString()}),yield x(f(l,"conversations",n),{lastMessageAt:(new Date).toISOString()}),T("")}}catch(t){if(!z)return;w({message:"Erreur lors de l'envoi du message",severity:"error"})}finally{B(!1)}}}),te=()=>R(null,null,function*(){if(z)try{yield s.signOut(),o("/login"),w({message:"D√©connexion r√©ussie",severity:"success"})}catch(e){if(!z)return;w({message:"Erreur lors de la d√©connexion",severity:"error"})}}),re=i.useMemo(()=>A.map((e,n)=>{var i,a,o,l;return t("div",{style:{display:"flex",justifyContent:e.sender===(null==(i=s.currentUser)?void 0:i.email)?"flex-end":"flex-start",marginBottom:"12px",padding:"0 16px"},children:r("div",{style:{maxWidth:"70%",padding:"12px 16px",borderRadius:"18px",background:e.sender===(null==(a=s.currentUser)?void 0:a.email)?"linear-gradient(135deg, #1cc6ff 0%, #009fff 100%)":"rgba(255, 255, 255, 0.1)",color:"#fff",wordWrap:"break-word",boxShadow:e.sender===(null==(o=s.currentUser)?void 0:o.email)?"0 2px 8px rgba(28, 198, 255, 0.3)":"none"},children:["voice"===e.type?t(j,{audioUrl:e.audioURL,duration:e.duration}):t("div",{style:{fontSize:"14px",lineHeight:"1.4"},children:e.text}),t("div",{style:{fontSize:"11px",opacity:.7,marginTop:"4px",textAlign:e.sender===(null==(l=s.currentUser)?void 0:l.email)?"right":"left"},children:new Date(e.timestamp).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})})]})},e.id||n)}),[A,null==(n=s.currentUser)?void 0:n.email,z]);return r("div",{style:{width:"100vw",height:"100vh",background:"linear-gradient(135deg, #181828 0%, #23234a 100%)",display:"flex",overflow:"hidden",flexDirection:k?"column":"row"},children:[t(O,{children:t(U,{onSelectContact:Z,selectedContact:M})}),r("div",{style:{flex:1,display:"flex",flexDirection:"column",background:"rgba(28, 198, 255, 0.02)",backdropFilter:"blur(10px)",minHeight:k?"60vh":"auto"},children:[r("div",{style:{padding:E("12px 16px","20px"),borderBottom:"1px solid rgba(62, 242, 255, 0.2)",display:"flex",alignItems:"center",justifyContent:"space-between",background:"rgba(255, 255, 255, 0.05)",backdropFilter:"blur(10px)",minHeight:k?"60px":"auto"},children:[r("div",{style:{display:"flex",alignItems:"center",gap:E("8px","12px")},children:[t("button",{onClick:()=>V(!F),"aria-label":"Afficher la liste des contacts",role:"button",tabIndex:0,style:I({background:"none",border:"none",color:"#fff",fontSize:E("20px","24px"),cursor:"pointer",padding:E("8px","8px"),borderRadius:"8px",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center"},D()),onMouseEnter:e=>e.target.style.background="rgba(255, 255, 255, 0.1)",onMouseLeave:e=>e.target.style.background="none",onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),V(!F))},children:"üë•"}),M&&r("div",{children:[t("h2",{style:{margin:0,fontSize:E("16px","18px"),fontWeight:"600",color:"#fff"},children:M.displayName}),r("div",{style:{fontSize:E("10px","12px"),color:M.online?"#4caf50":"#666",display:"flex",alignItems:"center",gap:"4px"},children:[t("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:M.online?"#4caf50":"#666"}}),M.online?"En ligne":"Hors ligne"]})]})]}),r("div",{style:{display:"flex",alignItems:"center",gap:E("6px","8px")},children:[t("button",{onClick:()=>o("/profile"),"aria-label":"Acc√©der au profil",role:"button",tabIndex:0,style:I({background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"8px",color:"#fff",padding:E("6px 10px","8px 12px"),cursor:"pointer",fontSize:E("12px","14px"),fontWeight:"600",transition:"all 0.2s ease"},D()),onMouseEnter:e=>e.target.style.background="rgba(255, 255, 255, 0.2)",onMouseLeave:e=>e.target.style.background="rgba(255, 255, 255, 0.1)",onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),o("/profile"))},children:"Profil"}),t("button",{onClick:te,"aria-label":"Se d√©connecter",role:"button",tabIndex:0,style:I({background:"linear-gradient(90deg, #ff4d4d 0%, #ff0000 100%)",border:"none",borderRadius:"8px",color:"#fff",padding:E("6px 12px","8px 16px"),cursor:"pointer",fontSize:E("12px","14px"),fontWeight:"600",transition:"all 0.2s ease"},D()),onMouseEnter:e=>e.target.style.transform="translateY(-1px)",onMouseLeave:e=>e.target.style.transform="translateY(0)",onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),te())},children:"D√©connexion"})]})]}),t("div",{style:{flex:1,overflowY:"auto",padding:E("8px 0","16px 0"),background:"rgba(28, 198, 255, 0.01)",scrollBehavior:"smooth",WebkitOverflowScrolling:"touch"},children:0===A.length?t("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"rgba(255, 255, 255, 0.6)",fontSize:E("14px","16px"),textAlign:"center",padding:E("20px","40px")},children:M?`Commencez √† discuter avec ${M.displayName} !`:"S√©lectionnez un contact pour commencer √† discuter"}):t("div",{style:{display:"flex",flexDirection:"column",gap:E("6px","8px")},children:re})}),t("div",{style:{padding:E("12px 16px","20px"),borderTop:"1px solid rgba(62, 242, 255, 0.2)",background:"rgba(255, 255, 255, 0.05)",backdropFilter:"blur(10px)"},children:r("form",{onSubmit:ee,style:{display:"flex",alignItems:"center",gap:E("8px","12px")},children:[t("input",{type:"text",value:H,onChange:e=>T(e.target.value),placeholder:"Tapez votre message...",disabled:!M||P,"aria-label":"Saisir un message",role:"textbox",style:{flex:1,padding:E("12px 14px","12px 16px"),border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:E("20px","24px"),background:"rgba(255, 255, 255, 0.1)",color:"#fff",fontSize:E("14px","16px"),minHeight:E("44px","auto"),outline:"none",transition:"all 0.2s ease"},onFocus:e=>{e.target.style.borderColor="#1cc6ff",e.target.style.background="rgba(255, 255, 255, 0.15)"},onBlur:e=>{e.target.style.borderColor="rgba(255, 255, 255, 0.2)",e.target.style.background="rgba(255, 255, 255, 0.1)"}}),t("button",{type:"button",onClick:()=>K(!0),disabled:!M||P,"aria-label":"Enregistrer un message vocal",role:"button",tabIndex:0,style:{background:"linear-gradient(135deg, #1cc6ff 0%, #009fff 100%)",border:"none",borderRadius:"50%",width:E("44px","48px"),height:E("44px","48px"),color:"#fff",cursor:M&&!P?"pointer":"not-allowed",fontSize:E("18px","20px"),display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",opacity:M&&!P?1:.5,minWidth:E("44px","auto"),minHeight:E("44px","auto")},onMouseEnter:e=>{M&&!P&&(e.target.style.transform="translateY(-1px)",e.target.style.boxShadow="0 4px 12px rgba(28, 198, 255, 0.3)")},onMouseLeave:e=>{e.target.style.transform="translateY(0)",e.target.style.boxShadow="none"},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||!M||P||(e.preventDefault(),K(!0))},children:"üé§"}),t("button",{type:"submit",disabled:!M||!H.trim()||P,"aria-label":"Envoyer le message",role:"button",tabIndex:0,style:{background:"linear-gradient(135deg, #1cc6ff 0%, #009fff 100%)",border:"none",borderRadius:E("20px","24px"),padding:E("12px 20px","12px 24px"),color:"#fff",cursor:M&&H.trim()&&!P?"pointer":"not-allowed",fontSize:E("14px","16px"),fontWeight:"600",transition:"all 0.2s ease",opacity:M&&H.trim()&&!P?1:.5,minWidth:E("44px","auto"),minHeight:E("44px","auto")},onMouseEnter:e=>{M&&H.trim()&&!P&&(e.target.style.transform="translateY(-1px)",e.target.style.boxShadow="0 4px 12px rgba(28, 198, 255, 0.3)")},onMouseLeave:e=>{e.target.style.transform="translateY(0)",e.target.style.boxShadow="none"},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||!M||!H.trim()||P||(e.preventDefault(),ee(e))},children:"Envoyer"})]})})]}),Y&&t(O,{children:t(L,{onClose:()=>K(!1),onSend:(e,t)=>R(null,null,function*(){if(M&&z){B(!0);try{const r=yield(e=>R(null,null,function*(){if(!z)return null;try{const t=`voice_messages/${Date.now()}_${s.currentUser.uid}.webm`,r=h(d,t);return yield v(r,e),yield S(r)}catch(t){if(!z)return null;throw new Error("Erreur lors de l'upload du fichier audio")}}))(e),n=c(l,"conversations"),i=p(n,m("participants","array-contains",s.currentUser.email)),a=yield y(i);let o=null;if(a.forEach(e=>{e.data().participants.includes(M.email)&&(o=e.id)}),o){const e=c(l,"conversations",o,"messages");yield b(e,{sender:s.currentUser.email,type:"voice",audioURL:r,duration:t,timestamp:(new Date).toISOString()}),yield x(f(l,"conversations",o),{lastMessageAt:(new Date).toISOString()})}}catch(r){if(!z)return;w({message:"Erreur lors de l'envoi du message vocal",severity:"error"})}finally{B(!1)}}})})})]})}o.memo(({message:e,isOwnMessage:n,scrollToBottom:a})=>{const o=i.useRef(null);return i.useEffect(()=>{n&&o.current&&o.current.scrollIntoView({behavior:"smooth"})},[n]),t("div",{ref:o,style:{display:"flex",justifyContent:n?"flex-end":"flex-start",marginBottom:"8px",padding:"0 16px"},children:r("div",{style:{maxWidth:"70%",padding:"12px 16px",borderRadius:"18px",background:n?"linear-gradient(135deg, #1cc6ff 0%, #009fff 100%)":"rgba(255, 255, 255, 0.1)",color:"#fff",wordWrap:"break-word",backdropFilter:"blur(10px)",border:n?"none":"1px solid rgba(255, 255, 255, 0.1)"},children:["voice"===e.type?t(_,{audioURL:e.audioURL,duration:e.duration}):t("span",{style:{fontSize:"15px",lineHeight:"1.4"},children:e.text}),t("div",{style:{fontSize:"11px",opacity:.7,marginTop:"4px",textAlign:n?"right":"left"},children:new Date(e.timestamp).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})})]})})});export{A as default};
