import{r as s}from"./vendor-a6qBUclc.js";import{a as e,j as a}from"./index-zUlum8ji.js";import{m as i,A as t}from"./ui-Br0gaIZz.js";var r=(s,e,a)=>new Promise((i,t)=>{var r=s=>{try{l(a.next(s))}catch(e){t(e)}},c=s=>{try{l(a.throw(s))}catch(e){t(e)}},l=s=>s.done?i(s.value):Promise.resolve(s.value).then(r,c);l((a=a.apply(s,e)).next())});const c=({onUserSelect:c,onClose:l,filter:n="all"})=>{const[o,d]=s.useState(""),[u,h]=s.useState(!1),{users:m,contacts:p,searchResults:x,setSearchResults:j,clearSearchResults:v,addContact:N,createChat:f,setActiveChat:y,chats:w,user:b}=e(),C=m.filter(s=>{var e,a;if(s.uid===(null==b?void 0:b.uid))return!1;if(""!==o&&!(null==(e=s.displayName)?void 0:e.toLowerCase().includes(o.toLowerCase()))&&!(null==(a=s.email)?void 0:a.toLowerCase().includes(o.toLowerCase())))return!1;switch(n){case"online":return"online"===s.status;case"recent":return s.lastSeen&&Date.now()-s.lastSeen<6048e5;default:return!0}}),L=s=>w.find(e=>2===e.participants.length&&e.participants.includes(null==b?void 0:b.uid)&&e.participants.includes(s)),R=s=>void 0!==L(s);return a.jsx(i.div,{className:"user-search-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:a.jsxs(i.div,{className:"user-search-modal",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},children:[a.jsxs("div",{className:"search-header",children:[a.jsx("h2",{children:"Rechercher des utilisateurs"}),a.jsx("button",{onClick:l,className:"btn btn-icon close-btn",children:a.jsx("i",{className:"fas fa-times"})})]}),a.jsx("div",{className:"search-input-container",children:a.jsxs("div",{className:"search-input-wrapper",children:[a.jsx("i",{className:"fas fa-search search-icon"}),a.jsx("input",{type:"text",placeholder:"Rechercher par nom ou email...",value:o,onChange:s=>{const e=s.target.value;d(e),e.trim()?(h(!0),setTimeout(()=>{j(C),h(!1)},500)):(v(),h(!1))},className:"search-input"}),u&&a.jsx("div",{className:"search-spinner",children:a.jsx("i",{className:"fas fa-spinner fa-spin"})})]})}),a.jsx("div",{className:"search-results",children:a.jsx(t,{children:x.length>0?a.jsx(i.div,{className:"results-list",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:x.map(s=>{return a.jsxs(i.div,{className:"user-result",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},whileHover:{scale:1.02},whileTap:{scale:.98},children:[a.jsxs("div",{className:"user-info",children:[a.jsx("div",{className:"user-avatar",children:s.photoURL?a.jsx("img",{src:s.photoURL,alt:s.displayName}):a.jsx("i",{className:"fas fa-user"})}),a.jsx("div",{className:"user-details",children:a.jsx("h3",{children:s.displayName||"Utilisateur"})})]}),a.jsx("div",{className:"user-actions",children:(e=s.uid,p.some(s=>s.uid===e)||R(s.uid)?a.jsxs("button",{onClick:()=>(s=>{(s=>{r(void 0,null,function*(){const e=L(s.uid);if(e)y(e.id);else{const e=yield f([b.uid,s.uid]);y(e)}c&&c(s)})})(s)})(s),className:"btn btn-sm btn-primary",children:[a.jsx("i",{className:"fas fa-comment"}),"Message"]}):a.jsxs("button",{onClick:()=>(s=>r(void 0,null,function*(){if(s.uid!==(null==b?void 0:b.uid))try{window.showLoading&&window.showLoading("Ajout du contact..."),yield N({uid:s.uid,displayName:s.displayName,email:s.email,photoURL:s.photoURL,addedAt:Date.now()})}catch(e){window.showError&&window.showError("Erreur lors de l'ajout du contact")}else window.showError&&window.showError("Vous ne pouvez pas vous ajouter vous-même")}))(s),className:"btn btn-sm btn-success",children:[a.jsx("i",{className:"fas fa-plus"}),"Ajouter"]}))})]},s.uid);var e})}):o&&!u?a.jsxs(i.div,{className:"no-results",initial:{opacity:0},animate:{opacity:1},children:[a.jsx("i",{className:"fas fa-search"}),a.jsx("p",{children:"Aucun utilisateur trouvé"})]}):a.jsxs(i.div,{className:"search-placeholder",initial:{opacity:0},animate:{opacity:1},children:[a.jsx("i",{className:"fas fa-users"}),a.jsx("p",{children:"Tapez pour rechercher des utilisateurs"})]})})})]})})};export{c as U};
