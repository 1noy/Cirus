import{r as e}from"./vendor-a6qBUclc.js";import{a as s,j as a,u as i,b as t,d as c}from"./index-zUlum8ji.js";import{A as n,m as l}from"./ui-Br0gaIZz.js";import{U as r}from"./UserSearch-BKQDS4fg.js";import{x as o,u as d,f as h}from"./firebase-NORewqm9.js";import"./router-DiJe-RGn.js";import"./query-BUSDR-nQ.js";import"./virtual-B5fKm2wJ.js";import"./utils-CkSu2hCt.js";import"./error-Dgluv6q7.js";import"./toast-CDmHSc_R.js";import"./state-PH8LGC8A.js";const m=({onContactSelect:i,onStartSearch:t})=>{const[c,r]=e.useState(null),{contacts:o,chats:d,setActiveChat:h,createChat:m,user:x}=s(),u=e=>{const s=d.find(s=>2===s.participants.length&&s.participants.includes(null==x?void 0:x.uid)&&s.participants.includes(e.uid));return(null==s?void 0:s.unreadCount)||0},p=e=>{if(!e)return"";const s=new Date(e),a=(new Date-s)/36e5;return a<24?s.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}):a<48?"Hier":s.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})};return a.jsxs("div",{className:"contacts-container",children:[a.jsxs("div",{className:"contacts-header",children:[a.jsx("h2",{children:"Contacts"}),a.jsxs("button",{onClick:t,className:"btn btn-sm add-btn",children:[a.jsx("i",{className:"fas fa-plus"}),"Nouveau contact"]})]}),a.jsx("div",{className:"contacts-list",children:a.jsx(n,{children:o.length>0?o.map((e,s)=>{const t=(e=>{const s=d.find(s=>2===s.participants.length&&s.participants.includes(null==x?void 0:x.uid)&&s.participants.includes(e.uid));return null==s?void 0:s.lastMessage})(e);return a.jsxs(l.div,{className:"contact-item "+((null==c?void 0:c.uid)===e.uid?"selected":""),initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{delay:.1*s},whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>(e=>{return s=function*(){r(e);const s=d.find(s=>2===s.participants.length&&s.participants.includes(null==x?void 0:x.uid)&&s.participants.includes(e.uid));if(s)h(s.id);else{const s=yield m([x.uid,e.uid]);h(s)}i&&i(e)},new Promise((e,a)=>{var i=e=>{try{c(s.next(e))}catch(i){a(i)}},t=e=>{try{c(s.throw(e))}catch(i){a(i)}},c=s=>s.done?e(s.value):Promise.resolve(s.value).then(i,t);c((s=s.apply(void 0,null)).next())});var s})(e),children:[a.jsxs("div",{className:"contact-avatar",children:[e.photoURL?a.jsx("img",{src:e.photoURL,alt:e.displayName}):a.jsx("i",{className:"fas fa-user"}),u(e)>0&&a.jsx("div",{className:"unread-badge",children:u(e)>99?"99+":u(e)})]}),a.jsxs("div",{className:"contact-info",children:[a.jsxs("div",{className:"contact-name-row",children:[a.jsx("h3",{children:e.displayName||"Utilisateur"}),e.autoAdded&&a.jsx("span",{className:"auto-added-badge",title:"Ajouté automatiquement",children:a.jsx("i",{className:"fas fa-magic"})})]}),t&&a.jsx("p",{className:"last-message",children:t.content})]}),a.jsxs("div",{className:"contact-meta",children:[t&&a.jsx("div",{className:"contact-time",children:p(t.timestamp)}),a.jsx("div",{className:"online-indicator",children:a.jsx("div",{className:"status-dot online"})})]})]},e.uid)}):a.jsxs(l.div,{className:"empty-contacts",initial:{opacity:0},animate:{opacity:1},children:[a.jsx("i",{className:"fas fa-users"}),a.jsx("h3",{children:"Aucun contact"}),a.jsx("p",{children:"Ajoutez des contacts pour commencer à discuter"}),a.jsxs("button",{onClick:t,className:"btn btn-primary",children:[a.jsx("i",{className:"fas fa-plus"}),"Ajouter un contact"]})]})})})]})};var x=Object.defineProperty,u=Object.defineProperties,p=Object.getOwnPropertyDescriptors,j=Object.getOwnPropertySymbols,f=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable,N=(e,s,a)=>s in e?x(e,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[s]=a,g=(e,s)=>{for(var a in s||(s={}))f.call(s,a)&&N(e,a,s[a]);if(j)for(var a of j(s))v.call(s,a)&&N(e,a,s[a]);return e},b=(e,s)=>u(e,p(s)),y=(e,s,a)=>new Promise((i,t)=>{var c=e=>{try{l(a.next(e))}catch(s){t(s)}},n=e=>{try{l(a.throw(e))}catch(s){t(s)}},l=e=>e.done?i(e.value):Promise.resolve(e.value).then(c,n);l((a=a.apply(e,s)).next())});const k=({onClose:r})=>{const[m,x]=e.useState("profile"),[u,p]=e.useState(!1),[j,f]=e.useState(""),[v,N]=e.useState(null),[k,C]=e.useState(""),[S,w]=e.useState(!1),[A,U]=e.useState(!0),[P,R]=e.useState(!0),[L,O]=e.useState(!0),M=e.useRef(null),{user:q,setUser:D}=s(),{showToast:E}=i(),F=(e,s)=>{switch(e){case"notifications":U(s),E("Notifications "+(s?"activées":"désactivées"),"success");break;case"darkMode":R(s),E("Mode sombre "+(s?"activé":"désactivé"),"success");break;case"autoSave":O(s),E("Sauvegarde automatique "+(s?"activée":"désactivée"),"success")}};return a.jsx(l.div,{className:"profile-settings-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:a.jsxs(l.div,{className:"profile-settings-modal",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},children:[a.jsxs("div",{className:"settings-header",children:[a.jsx("h2",{children:"Paramètres"}),a.jsx("button",{onClick:r,className:"btn btn-icon close-btn",children:a.jsx("i",{className:"fas fa-times"})})]}),a.jsx("div",{className:"settings-tabs",children:[{id:"profile",label:"Profil",icon:"fas fa-user"},{id:"privacy",label:"Confidentialité",icon:"fas fa-shield-alt"},{id:"notifications",label:"Notifications",icon:"fas fa-bell"},{id:"appearance",label:"Apparence",icon:"fas fa-palette"},{id:"advanced",label:"Avancé",icon:"fas fa-cog"}].map(e=>a.jsxs("button",{onClick:()=>x(e.id),className:"tab-btn "+(m===e.id?"active":""),children:[a.jsx("i",{className:e.icon}),a.jsx("span",{children:e.label})]},e.id))}),a.jsx("div",{className:"settings-content",children:a.jsxs(n,{mode:"wait",children:["profile"===m&&a.jsxs(l.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"tab-content",children:[a.jsxs("div",{className:"settings-section",children:[a.jsx("h3",{children:"Photo de profil"}),a.jsxs("div",{className:"profile-photo-container",children:[a.jsx("div",{className:"current-photo",children:(null==q?void 0:q.photoURL)?a.jsx("img",{src:q.photoURL,alt:"Photo de profil"}):a.jsx("i",{className:"fas fa-user"})}),a.jsxs("div",{className:"photo-actions",children:[a.jsxs("button",{onClick:()=>{var e;null==(e=M.current)||e.click()},className:"btn btn-secondary",children:[a.jsx("i",{className:"fas fa-camera"}),"Changer la photo"]}),a.jsx("input",{ref:M,type:"file",accept:"image/*",onChange:e=>{const s=e.target.files[0];if(s){if(!s.type.startsWith("image/"))return void E("Veuillez sélectionner une image","error");if(s.size>5242880)return void E("L'image doit faire moins de 5MB","error");N(s);const e=new FileReader;e.onload=e=>{C(e.target.result)},e.readAsDataURL(s)}},style:{display:"none"}})]})]}),k&&a.jsxs(l.div,{className:"photo-preview",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[a.jsx("h4",{children:"Aperçu"}),a.jsx("img",{src:k,alt:"Aperçu"}),a.jsxs("div",{className:"preview-actions",children:[a.jsx("button",{onClick:()=>y(void 0,null,function*(){if(v){w(!0);try{const e=URL.createObjectURL(v);yield o(t.currentUser,{photoURL:e}),yield d(h(c,"users",q.uid),{photoURL:e}),D(b(g({},q),{photoURL:e})),E("Photo de profil mise à jour !","success"),N(null),C("")}catch(e){E("Erreur lors de la mise à jour de la photo","error")}finally{w(!1)}}}),disabled:S,className:"btn btn-success save-btn",children:S?a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-spinner fa-spin"})," Upload..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-check"})," Confirmer"]})}),a.jsxs("button",{onClick:()=>{N(null),C("")},className:"btn btn-danger cancel-btn",children:[a.jsx("i",{className:"fas fa-times"}),"Annuler"]})]})]})]}),a.jsxs("div",{className:"settings-section",children:[a.jsx("h3",{children:"Pseudo"}),a.jsx("div",{className:"display-name-container",children:u?a.jsxs("div",{className:"edit-display-name",children:[a.jsx("input",{type:"text",value:j,onChange:e=>f(e.target.value),placeholder:"Nouveau pseudo",maxLength:20,className:"edit-input"}),a.jsxs("div",{className:"edit-actions",children:[a.jsxs("button",{onClick:()=>y(void 0,null,function*(){if(j.trim())if(j.length<3)E("Le pseudo doit faire au moins 3 caractères","error");else if(j.length>20)E("Le pseudo doit faire moins de 20 caractères","error");else try{yield o(t.currentUser,{displayName:j}),yield d(h(c,"users",q.uid),{displayName:j}),D(b(g({},q),{displayName:j})),E("Pseudo mis à jour !","success"),p(!1),f("")}catch(e){E("Erreur lors de la mise à jour du pseudo","error")}else E("Le pseudo ne peut pas être vide","error")}),className:"btn btn-success save-btn",children:[a.jsx("i",{className:"fas fa-check"}),"Sauvegarder"]}),a.jsxs("button",{onClick:()=>{p(!1),f("")},className:"btn btn-danger cancel-btn",children:[a.jsx("i",{className:"fas fa-times"}),"Annuler"]})]})]}):a.jsxs("div",{className:"current-display-name",children:[a.jsx("span",{className:"current-name",children:(null==q?void 0:q.displayName)||"Utilisateur"}),a.jsxs("button",{onClick:()=>{p(!0),f((null==q?void 0:q.displayName)||"")},className:"btn btn-warning edit-btn",children:[a.jsx("i",{className:"fas fa-edit"}),"Modifier"]})]})})]}),a.jsxs("div",{className:"settings-section",children:[a.jsx("h3",{children:"Informations"}),a.jsxs("div",{className:"info-list",children:[a.jsxs("div",{className:"info-item",children:[a.jsx("span",{className:"info-label",children:"Email:"}),a.jsx("span",{className:"info-value",children:(null==q?void 0:q.email)||"Non renseigné"})]}),a.jsxs("div",{className:"info-item",children:[a.jsx("span",{className:"info-label",children:"ID utilisateur:"}),a.jsx("span",{className:"info-value",children:null==q?void 0:q.uid})]})]})]})]},"profile"),"privacy"===m&&a.jsx(l.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"tab-content",children:a.jsxs("div",{className:"settings-section",children:[a.jsx("h3",{children:"Confidentialité"}),a.jsxs("div",{className:"setting-item",children:[a.jsxs("div",{className:"setting-info",children:[a.jsx("h4",{children:"Profil public"}),a.jsx("p",{children:"Permettre aux autres utilisateurs de voir votre profil"})]}),a.jsxs("label",{className:"toggle-switch",children:[a.jsx("input",{type:"checkbox",defaultChecked:!0}),a.jsx("span",{className:"toggle-slider"})]})]}),a.jsxs("div",{className:"setting-item",children:[a.jsxs("div",{className:"setting-info",children:[a.jsx("h4",{children:"Statut en ligne"}),a.jsx("p",{children:"Afficher votre statut en ligne aux autres"})]}),a.jsxs("label",{className:"toggle-switch",children:[a.jsx("input",{type:"checkbox",defaultChecked:!0}),a.jsx("span",{className:"toggle-slider"})]})]}),a.jsxs("div",{className:"setting-item",children:[a.jsxs("div",{className:"setting-info",children:[a.jsx("h4",{children:"Dernière connexion"}),a.jsx("p",{children:"Afficher votre dernière connexion"})]}),a.jsxs("label",{className:"toggle-switch",children:[a.jsx("input",{type:"checkbox"}),a.jsx("span",{className:"toggle-slider"})]})]})]})},"privacy"),"notifications"===m&&a.jsx(l.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"tab-content",children:a.jsxs("div",{className:"settings-section",children:[a.jsx("h3",{children:"Notifications"}),a.jsxs("div",{className:"setting-item",children:[a.jsxs("div",{className:"setting-info",children:[a.jsx("h4",{children:"Notifications push"}),a.jsx("p",{children:"Recevoir des notifications sur votre appareil"})]}),a.jsxs("label",{className:"toggle-switch",children:[a.jsx("input",{type:"checkbox",checked:A,onChange:e=>F("notifications",e.target.checked)}),a.jsx("span",{className:"toggle-slider"})]})]}),a.jsxs("div",{className:"setting-item",children:[a.jsxs("div",{className:"setting-info",children:[a.jsx("h4",{children:"Nouveaux messages"}),a.jsx("p",{children:"Notifications pour les nouveaux messages"})]}),a.jsxs("label",{className:"toggle-switch",children:[a.jsx("input",{type:"checkbox",defaultChecked:!0}),a.jsx("span",{className:"toggle-slider"})]})]}),a.jsxs("div",{className:"setting-item",children:[a.jsxs("div",{className:"setting-info",children:[a.jsx("h4",{children:"Nouveaux contacts"}),a.jsx("p",{children:"Notifications quand quelqu'un vous ajoute"})]}),a.jsxs("label",{className:"toggle-switch",children:[a.jsx("input",{type:"checkbox",defaultChecked:!0}),a.jsx("span",{className:"toggle-slider"})]})]})]})},"notifications"),"appearance"===m&&a.jsx(l.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"tab-content",children:a.jsxs("div",{className:"settings-section",children:[a.jsx("h3",{children:"Apparence"}),a.jsxs("div",{className:"setting-item",children:[a.jsxs("div",{className:"setting-info",children:[a.jsx("h4",{children:"Mode sombre"}),a.jsx("p",{children:"Activer le thème sombre"})]}),a.jsxs("label",{className:"toggle-switch",children:[a.jsx("input",{type:"checkbox",checked:P,onChange:e=>F("darkMode",e.target.checked)}),a.jsx("span",{className:"toggle-slider"})]})]}),a.jsxs("div",{className:"setting-item",children:[a.jsxs("div",{className:"setting-info",children:[a.jsx("h4",{children:"Animations"}),a.jsx("p",{children:"Activer les animations d'interface"})]}),a.jsxs("label",{className:"toggle-switch",children:[a.jsx("input",{type:"checkbox",defaultChecked:!0}),a.jsx("span",{className:"toggle-slider"})]})]}),a.jsxs("div",{className:"setting-item",children:[a.jsxs("div",{className:"setting-info",children:[a.jsx("h4",{children:"Effets visuels"}),a.jsx("p",{children:"Activer les effets néon et cyberpunk"})]}),a.jsxs("label",{className:"toggle-switch",children:[a.jsx("input",{type:"checkbox",defaultChecked:!0}),a.jsx("span",{className:"toggle-slider"})]})]})]})},"appearance"),"advanced"===m&&a.jsx(l.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"tab-content",children:a.jsxs("div",{className:"settings-section",children:[a.jsx("h3",{children:"Paramètres avancés"}),a.jsxs("div",{className:"setting-item",children:[a.jsxs("div",{className:"setting-info",children:[a.jsx("h4",{children:"Sauvegarde automatique"}),a.jsx("p",{children:"Sauvegarder automatiquement vos données"})]}),a.jsxs("label",{className:"toggle-switch",children:[a.jsx("input",{type:"checkbox",checked:L,onChange:e=>F("autoSave",e.target.checked)}),a.jsx("span",{className:"toggle-slider"})]})]}),a.jsxs("div",{className:"setting-item",children:[a.jsxs("div",{className:"setting-info",children:[a.jsx("h4",{children:"Mode développeur"}),a.jsx("p",{children:"Activer les outils de développement"})]}),a.jsxs("label",{className:"toggle-switch",children:[a.jsx("input",{type:"checkbox"}),a.jsx("span",{className:"toggle-slider"})]})]}),a.jsxs("div",{className:"settings-section",children:[a.jsx("h3",{children:"Actions"}),a.jsxs("div",{className:"action-buttons",children:[a.jsxs("button",{className:"btn btn-warning",children:[a.jsx("i",{className:"fas fa-download"}),"Exporter les données"]}),a.jsxs("button",{className:"btn btn-danger",children:[a.jsx("i",{className:"fas fa-trash"}),"Supprimer le compte"]})]})]})]})},"advanced")]})})]})})},C=()=>{const{selectedContact:i,setSelectedContact:t}=s(),[c,o]=e.useState("home"),[d,h]=e.useState(!1),[x,u]=e.useState(!1),[p,j]=e.useState("all"),[f]=e.useState({messages:3,search:1}),v=e.useCallback(e=>{o(e)},[]),N=e.useCallback(e=>{t(e)},[t]),g=e.useCallback(()=>{u(!x)},[x]),b=e.useCallback(e=>{j(e)},[]),y="home"===c,C="messages"===c,S="search"===c;return a.jsxs("div",{className:"home-page",children:[a.jsxs("nav",{className:"home-tabs",children:[a.jsxs("div",{className:"nav-buttons",children:[a.jsxs("button",{onClick:()=>v("home"),className:"nav-tab "+(y?"active":""),children:[a.jsx("i",{className:"fas fa-home"}),a.jsx("span",{children:"Accueil"})]}),a.jsxs("button",{onClick:()=>v("messages"),className:"nav-tab "+(C?"active":""),children:[a.jsx("i",{className:"fas fa-comments"}),a.jsx("span",{children:"Messages"}),f.messages>0&&a.jsx("div",{className:"notification-badge",children:f.messages})]}),a.jsxs("button",{onClick:()=>v("search"),className:"nav-tab "+(S?"active":""),children:[a.jsx("i",{className:"fas fa-search"}),a.jsx("span",{children:"Recherche"})]})]}),a.jsx("div",{className:"nav-actions",children:a.jsx("button",{onClick:g,className:"btn btn-icon profile-btn",title:"Paramètres du profil",children:a.jsx("i",{className:"fas fa-cog"})})})]}),a.jsx("div",{className:"home-content",children:a.jsxs(n,{mode:"wait",children:[y&&a.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"content-section hero",children:[a.jsx("div",{className:"cirus-neon-text",style:{fontSize:"4rem",color:"#ff00ff",textShadow:"0 0 10px #ff00ff, 0 0 20px #ff00ff, 0 0 30px #ff00ff",marginBottom:"20px"},children:"CIRUS"}),a.jsx("p",{className:"status-pill",children:"✅ Application CirusChat - Fonctionnelle"}),a.jsx("p",{className:"url-hint",children:"URL: http://192.168.0.103:5173"})]},"home"),C&&a.jsx(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"content-section",children:a.jsx("div",{className:"contacts-wrapper",children:a.jsx(m,{onContactSelect:N,onStartSearch:()=>v("search")})})},"messages"),S&&a.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"content-section",children:[a.jsxs("div",{className:"search-header",children:[a.jsxs("h2",{children:[a.jsx("i",{className:"fas fa-search"}),"Recherche"]}),a.jsx("p",{children:"Trouvez de nouveaux utilisateurs"})]}),a.jsxs("div",{className:"search-filters",children:[a.jsx("button",{className:"filter-btn "+("all"===p?"active":""),onClick:()=>b("all"),children:"Tous"}),a.jsx("button",{className:"filter-btn "+("online"===p?"active":""),onClick:()=>b("online"),children:"En ligne"}),a.jsx("button",{className:"filter-btn "+("recent"===p?"active":""),onClick:()=>b("recent"),children:"Récents"})]}),a.jsx("div",{className:"search-content",children:a.jsx(r,{onClose:()=>v("home"),filter:p})})]},"search")]})}),a.jsxs(n,{children:[d&&a.jsx(r,{onUserSelect:e=>{t(e),h(!1)},onClose:()=>h(!1)}),x&&a.jsx(k,{onClose:()=>u(!1)})]})]})};export{C as default};
