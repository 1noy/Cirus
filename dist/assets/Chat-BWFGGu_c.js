import{r as e}from"./vendor-a6qBUclc.js";import{u as t,j as s,d as r}from"./index-D1vrlXRx.js";import{q as a,o,j as n,m as i,n as l,v as d}from"./firebase-DkCmMj31.js";import"./router-6DPnlj19.js";import"./query-BUSDR-nQ.js";import"./virtual-B5fKm2wJ.js";import"./utils-CkSu2hCt.js";import"./error-Dgluv6q7.js";import"./toast-CDmHSc_R.js";import"./state-PH8LGC8A.js";var m=Object.defineProperty,c=Object.getOwnPropertySymbols,u=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,j=(e,t,s)=>t in e?m(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;const h=()=>{const{user:m,messages:h,setMessages:v,addMessage:g,logout:y}=t();return e.useEffect(()=>{const e=a(n(r,"chats","global","messages"),o("timestamp","asc")),t=i(e,e=>{const t=[];e.forEach(e=>t.push(((e,t)=>{for(var s in t||(t={}))u.call(t,s)&&j(e,s,t[s]);if(c)for(var s of c(t))p.call(t,s)&&j(e,s,t[s]);return e})({id:e.id},e.data()))),v("global",t)});return()=>t()},[v]),s.jsxs("div",{style:{maxWidth:720,margin:"5vh auto",padding:16},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx("h2",{children:"Chat"}),s.jsx("button",{onClick:y,children:"Se dÃ©connecter"})]}),s.jsx("div",{style:{border:"1px solid #333",borderRadius:8,height:"60vh",overflowY:"auto",padding:12},children:(h.global||[]).map(e=>s.jsxs("div",{style:{marginBottom:8},children:[s.jsx("b",{children:e.senderId===(null==m?void 0:m.uid)?"Moi":e.senderId}),": ",e.content]},e.id))}),s.jsxs("form",{onSubmit:e=>{return t=function*(){e.preventDefault();const t=e.currentTarget.elements.msg,s=t.value.trim();s&&(t.value="",yield l(n(r,"chats","global","messages"),{content:s,senderId:null==m?void 0:m.uid,timestamp:d(),type:"text"}))},new Promise((s,r)=>{var a=s=>{try{n(t.next(s))}catch(e){r(e)}},o=s=>{try{n(t.throw(s))}catch(e){r(e)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(a,o);n((t=t.apply(undefined,null)).next())});var t},style:{display:"flex",gap:8,marginTop:12},children:[s.jsx("input",{name:"msg",placeholder:"Votre message",style:{flex:1}}),s.jsx("button",{type:"submit",children:"Envoyer"})]})]})};export{h as default};
