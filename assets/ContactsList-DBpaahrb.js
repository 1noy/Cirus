import{u as e,a as t,j as r}from"./index-Bz0zDojz.js";import{r as n,b as i}from"./react-core-Bb0gnVVB.js";import{c as a,q as o,w as l,l as s,g as d,h as c,d as p,b as f}from"./firebase-firestore-B0lvOGz2.js";import{d as u,a as g}from"./firebase-Cc3EvCVe.js";import"./mui-eVobQS_6.js";import"./emotion-BB-a1p0A.js";import"./router-Db56Mi_u.js";import"./firebase-auth-DogJ4AYO.js";import"./firebase-storage-r8t-BqtU.js";var h=Object.defineProperty,x=Object.getOwnPropertySymbols,m=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable,b=(e,t,r)=>t in e?h(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,w=(e,t)=>{for(var r in t||(t={}))m.call(t,r)&&b(e,r,t[r]);if(x)for(var r of x(t))y.call(t,r)&&b(e,r,t[r]);return e};function v({contacts:i,onUserSelect:c,onClose:p,onMessage:f}){const[h,x]=n.useState(""),[m,y]=n.useState([]),[b,v]=n.useState(!1),[S,k]=n.useState(!0),{showToast:C}=e();n.useEffect(()=>(k(!0),()=>{k(!1)}),[]);const W=n.useCallback(e=>{return t=this,r=function*(){if(!e.trim()||e.length<3||!S)S&&y([]);else{v(!0);try{const t=a(u,"users"),r=o(t,l("email",">=",e),l("email","<=",e+""),s(10)),n=yield d(r),i=[];n.forEach(e=>{var t;const r=e.data();r.email!==(null==(t=g.currentUser)?void 0:t.email)&&i.push(w({id:e.id},r))});const c=o(t,l("displayName",">=",e),l("displayName","<=",e+""),s(10)),p=yield d(c),f=[];p.forEach(e=>{var t;const r=e.data();r.email!==(null==(t=g.currentUser)?void 0:t.email)&&f.push(w({id:e.id},r))});const h=[...i,...f].filter((e,t,r)=>t===r.findIndex(t=>t.id===e.id));S&&y(h)}catch(t){S&&C({message:"Erreur lors de la recherche",severity:"error"})}finally{S&&v(!1)}}},new Promise((e,n)=>{var i=e=>{try{o(r.next(e))}catch(t){n(t)}},a=e=>{try{o(r.throw(e))}catch(t){n(t)}},o=t=>t.done?e(t.value):Promise.resolve(t.value).then(i,a);o((r=r.apply(t,null)).next())});var t,r},[C,S]),j=n.useCallback(e=>{const t=e.target.value;x(t),t.length>=3?W(t):y([])},[W]),z=n.useCallback(e=>{if(S){const t=null==i?void 0:i.find(t=>t.email===e.email);t?f?f(t):c(t):c(e),p()}},[c,f,p,S,i]),R=n.useCallback(e=>i&&i.some(t=>t.email===e.email),[i]),E=n.useCallback(e=>null==i?void 0:i.find(t=>t.email===e.email),[i]);return t("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(5px)"},children:r("div",{style:{background:"linear-gradient(135deg, #23234a 0%, #181828 100%)",padding:"24px",borderRadius:"12px",width:"500px",maxHeight:"80vh",border:"1px solid rgba(62, 242, 255, 0.3)",overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)"},children:[r("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[t("h3",{style:{margin:0,fontSize:"18px",fontWeight:"bold",color:"#3ef2ff"},children:"Rechercher des utilisateurs"}),t("button",{onClick:p,style:{background:"none",border:"none",color:"#fff",fontSize:"24px",cursor:"pointer",padding:"0",width:"30px",height:"30px",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s"},onMouseEnter:e=>{e.target.style.color="#3ef2ff"},onMouseLeave:e=>{e.target.style.color="#fff"},children:"×"})]}),t("input",{type:"text",placeholder:"Rechercher par email ou nom...",value:h,onChange:j,style:{width:"100%",padding:"12px 16px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(62, 242, 255, 0.3)",borderRadius:"8px",color:"#fff",fontSize:"14px",marginBottom:"16px",transition:"all 0.3s ease",outline:"none"},onFocus:e=>{e.target.style.border="1px solid rgba(62, 242, 255, 0.6)",e.target.style.boxShadow="0 0 0 3px rgba(62, 242, 255, 0.1)"},onBlur:e=>{e.target.style.border="1px solid rgba(62, 242, 255, 0.3)",e.target.style.boxShadow="none"}}),t("div",{style:{flex:1,overflowY:"auto",border:"1px solid rgba(62, 242, 255, 0.2)",borderRadius:"8px",background:"rgba(255, 255, 255, 0.05)"},children:b?r("div",{style:{textAlign:"center",padding:"20px",color:"#a0f0ff",fontSize:"14px"},children:[t("div",{style:{fontSize:"24px",marginBottom:"8px"},children:"⏳"}),"Recherche en cours..."]}):0===m.length?r("div",{style:{textAlign:"center",padding:"20px",color:"#a0f0ff",fontSize:"14px"},children:[t("div",{style:{fontSize:"32px",marginBottom:"8px"},children:h.length>=3?"🔍":"💡"}),h.length>=3?"Aucun utilisateur trouvé":"Tapez au moins 3 caractères pour rechercher"]}):m.map(e=>r("div",{onClick:()=>{if(R(e)){const t=E(e);t&&f&&(f(t),p())}else z(e)},style:{padding:"12px 16px",borderBottom:"1px solid rgba(62, 242, 255, 0.1)",cursor:"pointer",transition:"background 0.2s",display:"flex",alignItems:"center",gap:"12px"},onMouseEnter:e=>{e.target.style.background="rgba(28, 198, 255, 0.1)"},onMouseLeave:e=>{e.target.style.background="transparent"},children:[t("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:e.avatar||"linear-gradient(135deg, #1cc6ff 0%, #009fff 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"bold",color:"#fff",overflow:"hidden"},children:e.avatar?t("img",{src:e.avatar,alt:"Avatar",style:{width:"100%",height:"100%",objectFit:"cover"}}):(e.displayName||e.email).charAt(0).toUpperCase()}),r("div",{style:{flex:1},children:[r("div",{style:{fontWeight:"bold",fontSize:"14px",color:e.online?"#4caf50":"#fff",display:"flex",alignItems:"center",gap:"8px"},children:[e.displayName||e.email,e.online&&t("span",{style:{fontSize:"10px",background:"#4caf50",color:"#fff",padding:"2px 6px",borderRadius:"10px"},children:"En ligne"}),R(e)&&t("span",{style:{fontSize:"10px",background:"rgba(76, 175, 80, 0.2)",color:"#4caf50",padding:"2px 6px",borderRadius:"10px",border:"1px solid rgba(76, 175, 80, 0.3)"},children:"✓ Contact existant"})]}),r("div",{style:{fontSize:"12px",color:"#a0f0ff",marginTop:"2px",display:"flex",alignItems:"center",gap:"4px"},children:[e.email,R(e)&&t("span",{style:{fontSize:"10px",color:"#4caf50",fontStyle:"italic"},children:"(Cliquer pour ouvrir le chat)"})]})]}),R(e)?r("div",{style:{display:"flex",gap:"8px"},children:[t("span",{style:{fontSize:"10px",color:"#4caf50",background:"rgba(76, 175, 80, 0.2)",padding:"2px 6px",borderRadius:"4px",display:"flex",alignItems:"center"},children:"✓ Contact"}),t("button",{onClick:t=>{t.stopPropagation();const r=E(e);r&&f&&(f(r),p())},style:{padding:"6px 12px",background:"linear-gradient(90deg, #4caf50 0%, #45a049 100%)",border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"12px",fontWeight:"600",transition:"all 0.2s"},onMouseEnter:e=>{e.target.style.transform="scale(1.05)",e.target.style.boxShadow="0 2px 8px rgba(76, 175, 80, 0.3)"},onMouseLeave:e=>{e.target.style.transform="scale(1)",e.target.style.boxShadow="none"},children:"Ouvrir chat"})]}):t("button",{onClick:t=>{t.stopPropagation(),z(e)},style:{padding:"6px 12px",background:"linear-gradient(90deg, #1cc6ff 0%, #009fff 100%)",border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"12px",fontWeight:"600",transition:"all 0.2s"},onMouseEnter:e=>{e.target.style.transform="scale(1.05)",e.target.style.boxShadow="0 2px 8px rgba(28, 198, 255, 0.3)"},onMouseLeave:e=>{e.target.style.transform="scale(1)",e.target.style.boxShadow="none"},children:"Ajouter"})]},e.id))})]})})}var S=(e,t,r)=>new Promise((n,i)=>{var a=e=>{try{l(r.next(e))}catch(t){i(t)}},o=e=>{try{l(r.throw(e))}catch(t){i(t)}},l=e=>e.done?n(e.value):Promise.resolve(e.value).then(a,o);l((r=r.apply(e,t)).next())});i.memo(({src:e,alt:r,fallback:i="/favicon.svg"})=>{const[a,o]=n.useState(i),[l,s]=n.useState(!1),[d,c]=n.useState(!1);return n.useEffect(()=>{if(!e)return;const t=new Image;if(t.style.filter="blur(10px)",t.style.transition="filter 0.3s ease",t.onload=()=>{o(e),s(!0),t.style.filter="blur(0px)"},t.onerror=()=>{c(!0),s(!0)},(()=>{const e=document.createElement("canvas");return e.width=1,e.height=1,0===e.toDataURL("image/webp").indexOf("data:image/webp")})()&&e.includes(".")){const r=e.replace(/\.(jpg|jpeg|png)$/i,".webp");t.src=r}else t.src=e},[e]),t("img",{src:a,alt:r,loading:"lazy",decoding:"async",style:{width:"40px",height:"40px",borderRadius:"50%",objectFit:"cover",opacity:l?1:.5,transition:"opacity 0.3s ease",backgroundColor:d?"rgba(28, 198, 255, 0.2)":"transparent"}})});const k=i.memo(({contact:e,isSelected:n,onSelect:i})=>r("div",{onClick:()=>i(e),style:{display:"flex",alignItems:"center",padding:window.innerWidth<=768?"8px 12px":"12px 16px",margin:(window.innerWidth,"0 8px"),borderRadius:window.innerWidth<=768?"8px":"12px",background:n?"linear-gradient(135deg, #1cc6ff 0%, #009fff 100%)":"rgba(255, 255, 255, 0.05)",cursor:"pointer",transition:"all 0.2s ease",border:n?"1px solid rgba(28, 198, 255, 0.3)":"1px solid transparent",minHeight:window.innerWidth<=768?"44px":"auto"},onMouseEnter:e=>{n||(e.target.style.background="rgba(255, 255, 255, 0.1)",e.target.style.transform="translateX(4px)")},onMouseLeave:e=>{n||(e.target.style.background="rgba(255, 255, 255, 0.05)",e.target.style.transform="translateX(0)")},onKeyDown:t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),i(e))},role:"button",tabIndex:0,"aria-label":`Sélectionner ${e.displayName||e.email}`,children:[t("div",{style:{width:window.innerWidth<=768?"36px":"40px",height:window.innerWidth<=768?"36px":"40px",borderRadius:"50%",background:"linear-gradient(135deg, #1cc6ff 0%, #009fff 100%)",display:"flex",alignItems:"center",justifyContent:"center",marginRight:window.innerWidth<=768?"8px":"12px",fontSize:window.innerWidth<=768?"14px":"16px",fontWeight:"600",color:"#fff",flexShrink:0},children:(e.displayName||e.email).charAt(0).toUpperCase()}),r("div",{style:{flex:1,minWidth:0},children:[t("div",{style:{fontSize:window.innerWidth<=768?"13px":"14px",fontWeight:"600",color:"#fff",marginBottom:"2px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e.displayName||e.email.split("@")[0]}),t("div",{style:{fontSize:window.innerWidth<=768?"10px":"11px",color:n?"rgba(255, 255, 255, 0.8)":"rgba(255, 255, 255, 0.6)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e.email})]}),e.online&&t("div",{style:{width:window.innerWidth<=768?"8px":"10px",height:window.innerWidth<=768?"8px":"10px",borderRadius:"50%",background:"#4caf50",marginLeft:window.innerWidth<=768?"6px":"8px",flexShrink:0}})]}));function C({onSelectContact:i,selectedContact:s}){const[h,x]=n.useState([]),[m,y]=n.useState(""),[b,w]=n.useState(!1),[C,W]=n.useState(!0),{showToast:j}=e(),z=n.useCallback(()=>S(this,null,function*(){if(g.currentUser)try{const e=a(u,"users",g.currentUser.uid,"contacts"),t=yield d(e),r=new Map,n=[];t.docs.forEach(e=>{const t=e.data().email;r.has(t)?n.push(e.id):r.set(t,e.id)});const i=n.map(e=>c(p(u,"users",g.currentUser.uid,"contacts",e)));i.length>0&&(yield Promise.all(i))}catch(e){}}),[]),R=n.useCallback(()=>S(this,null,function*(){if(g.currentUser)try{const e=a(u,"users",g.currentUser.uid,"contacts"),t=yield d(e),r=[],n=new Set;for(const i of t.docs){const e=i.data();n.has(e.email)||(n.add(e.email),r.push({id:i.id,email:e.email,displayName:e.email.split("@")[0]}))}x(r)}catch(e){j({message:"Erreur lors du chargement des contacts",severity:"error"})}}),[j]);n.useEffect(()=>{W(!0),(()=>{S(this,null,function*(){try{yield z(),yield R()}catch(e){}finally{W(!1)}})})()},[z,R]);const E=e=>S(this,null,function*(){if(g.currentUser){W(!0);try{const t=a(u,"users",g.currentUser.uid,"contacts"),r=o(t,l("email","==",e)),n=yield d(r);n.empty||(yield c(p(u,"users",g.currentUser.uid,"contacts",n.docs[0].id)),j({message:"Contact supprimé avec succès",severity:"success"}),yield R())}catch(t){j({message:"Erreur lors de la suppression du contact",severity:"error"})}finally{W(!1)}}}),I=n.useMemo(()=>{if(!m)return h;const e=m.toLowerCase();return h.filter(t=>t.displayName.toLowerCase().includes(e)||t.email.toLowerCase().includes(e))},[h,m]),M=n.useCallback(e=>S(this,null,function*(){w(!1),W(!0);try{if(h.find(t=>t.email===e.email))return j({message:"Ce contact existe déjà dans votre liste",severity:"warning"}),void W(!1);const t=a(u,"users",g.currentUser.uid,"contacts"),r=o(t,l("email","==",e.email));if(!(yield d(r)).empty)return j({message:"Ce contact existe déjà dans votre liste",severity:"warning"}),void W(!1);yield f(t,{email:e.email,displayName:e.displayName||e.email.split("@")[0],addedAt:(new Date).toISOString()}),j({message:"Contact ajouté avec succès",severity:"success"}),yield R()}catch(t){j({message:"Erreur lors de l'ajout du contact",severity:"error"})}finally{W(!1)}}),[h,R,j]),U=n.useCallback(e=>{w(!1),i(e),j({message:`Discussion ouverte avec ${e.displayName||e.email}`,severity:"success"})},[i,j]);return r("div",{style:{width:window.innerWidth<=768?"100%":"300px",height:window.innerWidth<=768?"40vh":"100vh",background:"rgba(255, 255, 255, 0.05)",backdropFilter:"blur(10px)",borderRight:window.innerWidth<=768?"none":"1px solid rgba(62, 242, 255, 0.2)",borderBottom:window.innerWidth<=768?"1px solid rgba(62, 242, 255, 0.2)":"none",display:"flex",flexDirection:"column",overflow:"hidden"},children:[t("div",{style:{padding:window.innerWidth<=768?"12px 16px":"20px",borderBottom:"1px solid rgba(62, 242, 255, 0.2)",background:"rgba(255, 255, 255, 0.05)",backdropFilter:"blur(10px)",minHeight:window.innerWidth<=768?"60px":"auto"},children:r("h2",{style:{margin:0,fontSize:window.innerWidth<=768?"16px":"18px",fontWeight:"600",color:"#fff",display:"flex",alignItems:"center",justifyContent:"space-between"},children:["Contacts",t("button",{onClick:()=>w(!0),"aria-label":"Rechercher un utilisateur",role:"button",tabIndex:0,style:{background:"linear-gradient(135deg, #1cc6ff 0%, #009fff 100%)",border:"none",borderRadius:window.innerWidth<=768?"8px":"12px",color:"#fff",padding:window.innerWidth<=768?"6px 12px":"8px 16px",cursor:"pointer",fontSize:window.innerWidth<=768?"12px":"14px",fontWeight:"600",transition:"all 0.2s ease",minWidth:window.innerWidth<=768?"44px":"auto",minHeight:window.innerWidth<=768?"44px":"auto"},onMouseEnter:e=>{e.target.style.transform="translateY(-1px)",e.target.style.boxShadow="0 4px 12px rgba(28, 198, 255, 0.3)"},onMouseLeave:e=>{e.target.style.transform="translateY(0)",e.target.style.boxShadow="none"},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),w(!0))},children:"+"})]})}),t("div",{style:{flex:1,overflowY:"auto",padding:window.innerWidth<=768?"8px 0":"16px 0",scrollBehavior:"smooth",WebkitOverflowScrolling:"touch"},children:0===h.length?t("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"rgba(255, 255, 255, 0.6)",fontSize:window.innerWidth<=768?"12px":"14px",textAlign:"center",padding:window.innerWidth<=768?"20px":"40px"},children:"Aucun contact pour le moment"}):t("div",{style:{display:"flex",flexDirection:"column",gap:window.innerWidth<=768?"4px":"8px"},children:I.map(e=>t(k,{contact:e,isSelected:(null==s?void 0:s.email)===e.email,onSelect:i,onRemove:E},e.email))})}),b&&t(v,{onClose:()=>w(!1),onUserSelect:M,onMessage:U,contacts:h})]})}export{C as default};
