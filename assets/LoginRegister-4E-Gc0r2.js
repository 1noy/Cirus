import{u as e,a as t,j as i,F as n}from"./index-Bz0zDojz.js";import{r}from"./react-core-Bb0gnVVB.js";import{s as o,d as a}from"./firebase-firestore-B0lvOGz2.js";import{a as s,d}from"./firebase-Cc3EvCVe.js";import{G as l,s as p,l as u,m as c,n as g}from"./firebase-auth-DogJ4AYO.js";import{u as x}from"./router-Db56Mi_u.js";import"./mui-eVobQS_6.js";import"./emotion-BB-a1p0A.js";import"./firebase-storage-r8t-BqtU.js";var f=(e,t,i)=>new Promise((n,r)=>{var o=e=>{try{s(i.next(e))}catch(t){r(t)}},a=e=>{try{s(i.throw(e))}catch(t){r(t)}},s=e=>e.done?n(e.value):Promise.resolve(e.value).then(o,a);s((i=i.apply(e,t)).next())});function h({mode:h="login"}){const[b,w]=r.useState(h),[m,y]=r.useState(""),[v,W]=r.useState(""),[k,S]=r.useState(!1),[C,z]=r.useState(!0),E=x(),{showToast:D}=e(),[I,j]=r.useState(!1),[M,R]=r.useState(!1),[q,A]=r.useState(0);r.useEffect(()=>(z(!0),()=>{z(!1)}),[]);const H=()=>f(this,null,function*(){if(C){R(!0);try{const e=new l,t=(yield p(s,e)).user;yield o(a(d,"users",t.uid),{displayName:t.displayName||t.email.split("@")[0],email:t.email,avatar:t.photoURL||"",bio:"",phone:"",location:"",website:"",createdAt:(new Date).toISOString(),online:!0},{merge:!0}),C&&(E("/chat"),D({message:"Connexion Google r√©ussie !",severity:"success"}))}catch(e){if(C){R(!1);let t="Erreur lors de la connexion Google";"auth/popup-closed-by-user"===e.code?t="Connexion annul√©e":"auth/popup-blocked"===e.code&&(t="Popup bloqu√©. Autorisez les popups pour ce site."),D({message:t,severity:"error"})}}finally{C&&R(!1)}}}),L=e=>f(this,null,function*(){if(e.preventDefault(),C)if(m.trim())if(v.trim()){j(!0);try{let e=null;e="login"===b?yield c(s,m.trim(),v):yield g(s,m.trim(),v);const t=(null==e?void 0:e.user)||s.currentUser;if(!t)return void(C&&(j(!1),D({message:"Erreur d'authentification, r√©essaie.",severity:"error"})));"register"===b?yield o(a(d,"users",t.uid),{displayName:t.displayName||m.split("@")[0],email:t.email,avatar:"",bio:"",phone:"",location:"",website:"",createdAt:(new Date).toISOString(),online:!0}):yield o(a(d,"users",t.uid),{online:!0,lastSeen:(new Date).toISOString()},{merge:!0}),C&&(E("/chat"),D({message:"login"===b?"Connexion r√©ussie !":"Inscription r√©ussie !",severity:"success"}))}catch(t){if(C){j(!1);let e="Une erreur est survenue";if(t.code)switch(t.code){case"auth/email-already-in-use":e="Cet email est d√©j√† utilis√©. Connecte-toi √† la place.";break;case"auth/invalid-email":e="L'email n'est pas valide. V√©rifiez le format.";break;case"auth/weak-password":e="Le mot de passe doit faire au moins 6 caract√®res.";break;case"auth/wrong-password":e="Mot de passe incorrect. V√©rifiez votre saisie.";break;case"auth/user-not-found":e="Aucun compte trouv√© avec cet email. Cr√©ez un compte d'abord.";break;case"auth/invalid-credential":e="Email ou mot de passe incorrect. V√©rifiez vos identifiants.";break;case"auth/too-many-requests":e="Trop de tentatives. Attendez quelques minutes avant de r√©essayer.";break;case"auth/network-request-failed":e="Erreur de connexion. V√©rifiez votre internet.";break;default:e=`Erreur: ${t.code}`}else t.message&&(e=t.message);D({message:e,severity:"error"})}return}C&&j(!1)}else D({message:"Veuillez entrer votre mot de passe",severity:"error"});else D({message:"Veuillez entrer votre email",severity:"error"})}),V=()=>f(this,null,function*(){if(m.trim())try{yield u(s,m.trim()),D({message:"Email de r√©initialisation envoy√© ! V√©rifiez votre bo√Æte mail.",severity:"success"})}catch(e){let t="Erreur lors de l'envoi";"auth/user-not-found"===e.code?t="Aucun compte trouv√© avec cet email.":"auth/invalid-email"===e.code?t="L'email n'est pas valide.":"auth/too-many-requests"===e.code&&(t="Trop de demandes. Attendez quelques minutes."),D({message:t,severity:"error"})}else D({message:"Entre d'abord ton email pour r√©initialiser.",severity:"error"})});return t("div",{style:{width:"100vw",height:"100vh",background:"linear-gradient(135deg, #181828 0%, #23234a 100%)",display:"flex",alignItems:"center",justifyContent:"center",padding:window.innerWidth<=768?"16px":"40px"},children:i("div",{style:{background:"rgba(255, 255, 255, 0.05)",backdropFilter:"blur(20px)",borderRadius:window.innerWidth<=768?"16px":"24px",padding:window.innerWidth<=768?"24px":"40px",width:"100%",maxWidth:window.innerWidth<=768?"100%":"400px",border:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)"},children:[t("h1",{style:{textAlign:"center",color:"#1cc6ff",fontSize:window.innerWidth<=768?"24px":"32px",fontWeight:"800",marginBottom:window.innerWidth<=768?"20px":"32px"},children:"Cirus Chat"}),i("div",{style:{display:"flex",marginBottom:window.innerWidth<=768?"20px":"24px",background:"rgba(255, 255, 255, 0.1)",borderRadius:window.innerWidth<=768?"12px":"16px",padding:"4px"},children:[t("button",{type:"button",onClick:()=>w("login"),"aria-label":"Se connecter",role:"tab","aria-selected":"login"===b,tabIndex:"login"===b?0:-1,style:{flex:1,padding:window.innerWidth<=768?"10px 16px":"12px 24px",border:"none",borderRadius:window.innerWidth<=768?"8px":"12px",background:"login"===b?"linear-gradient(135deg, #1cc6ff 0%, #009fff 100%)":"transparent",color:"#fff",fontSize:window.innerWidth<=768?"14px":"16px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",minHeight:window.innerWidth<=768?"44px":"auto"},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),w("login"))},children:"Connexion"}),t("button",{type:"button",onClick:()=>w("register"),"aria-label":"S'inscrire",role:"tab","aria-selected":"register"===b,tabIndex:"register"===b?0:-1,style:{flex:1,padding:window.innerWidth<=768?"10px 16px":"12px 24px",border:"none",borderRadius:window.innerWidth<=768?"8px":"12px",background:"register"===b?"linear-gradient(135deg, #1cc6ff 0%, #009fff 100%)":"transparent",color:"#fff",fontSize:window.innerWidth<=768?"14px":"16px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",minHeight:window.innerWidth<=768?"44px":"auto"},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),w("register"))},children:"Inscription"})]}),i("form",{onSubmit:L,style:{display:"flex",flexDirection:"column",gap:window.innerWidth<=768?"16px":"20px"},children:[i("div",{children:[t("label",{htmlFor:"email",style:{display:"block",marginBottom:window.innerWidth<=768?"6px":"8px",color:"#fff",fontSize:window.innerWidth<=768?"14px":"16px",fontWeight:"600"},children:"Email"}),t("input",{id:"email",type:"email",value:m,onChange:e=>y(e.target.value),placeholder:"votre@email.com",required:!0,"aria-label":"Adresse email",role:"textbox",style:{width:"100%",padding:window.innerWidth<=768?"12px 14px":"12px 16px",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:window.innerWidth<=768?"12px":"16px",background:"rgba(255, 255, 255, 0.1)",color:"#fff",fontSize:window.innerWidth<=768?"14px":"16px",outline:"none",transition:"all 0.2s ease",minHeight:window.innerWidth<=768?"44px":"auto"},onFocus:e=>{e.target.style.borderColor="#1cc6ff",e.target.style.background="rgba(255, 255, 255, 0.15)"},onBlur:e=>{e.target.style.borderColor="rgba(255, 255, 255, 0.2)",e.target.style.background="rgba(255, 255, 255, 0.1)"}})]}),i("div",{children:[t("label",{htmlFor:"password",style:{display:"block",marginBottom:window.innerWidth<=768?"6px":"8px",color:"#fff",fontSize:window.innerWidth<=768?"14px":"16px",fontWeight:"600"},children:"Mot de passe"}),i("div",{style:{position:"relative"},children:[t("input",{id:"password",type:k?"text":"password",value:v,onChange:e=>W(e.target.value),placeholder:"Votre mot de passe",required:!0,"aria-label":"Mot de passe",role:"textbox",style:{width:"100%",padding:window.innerWidth<=768?"12px 14px":"12px 16px",paddingRight:(window.innerWidth,"48px"),border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:window.innerWidth<=768?"12px":"16px",background:"rgba(255, 255, 255, 0.1)",color:"#fff",fontSize:window.innerWidth<=768?"14px":"16px",outline:"none",transition:"all 0.2s ease",minHeight:window.innerWidth<=768?"44px":"auto"},onFocus:e=>{e.target.style.borderColor="#1cc6ff",e.target.style.background="rgba(255, 255, 255, 0.15)"},onBlur:e=>{e.target.style.borderColor="rgba(255, 255, 255, 0.2)",e.target.style.background="rgba(255, 255, 255, 0.1)"}}),t("button",{type:"button",onClick:()=>S(!k),"aria-label":k?"Masquer le mot de passe":"Afficher le mot de passe",role:"button",tabIndex:0,style:{position:"absolute",right:(window.innerWidth,"12px"),top:"50%",transform:"translateY(-50%)",background:"none",border:"none",color:"rgba(255, 255, 255, 0.7)",cursor:"pointer",fontSize:window.innerWidth<=768?"16px":"18px",padding:"4px",borderRadius:"4px",transition:"all 0.2s ease",minWidth:window.innerWidth<=768?"44px":"auto",minHeight:window.innerWidth<=768?"44px":"auto"},onMouseEnter:e=>e.target.style.color="#fff",onMouseLeave:e=>e.target.style.color="rgba(255, 255, 255, 0.7)",onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),S(!k))},children:k?"üëÅÔ∏è":"üëÅÔ∏è‚Äçüó®Ô∏è"})]})]}),t("button",{type:"submit",disabled:I,"aria-label":"login"===b?"Se connecter":"S'inscrire",role:"button",tabIndex:0,style:{width:"100%",padding:window.innerWidth<=768?"14px 20px":"14px 24px",border:"none",borderRadius:window.innerWidth<=768?"12px":"16px",background:"linear-gradient(135deg, #1cc6ff 0%, #009fff 100%)",color:"#fff",fontSize:window.innerWidth<=768?"16px":"18px",fontWeight:"700",cursor:I?"not-allowed":"pointer",transition:"all 0.2s ease",opacity:I?.6:1,minHeight:window.innerWidth<=768?"48px":"auto",position:"relative"},onMouseEnter:e=>{I||(e.target.style.transform="translateY(-1px)",e.target.style.boxShadow="0 4px 12px rgba(28, 198, 255, 0.3)")},onMouseLeave:e=>{e.target.style.transform="translateY(0)",e.target.style.boxShadow="none"},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||I||(e.preventDefault(),L(e))},children:I?i("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[t("div",{style:{width:"16px",height:"16px",border:"2px solid rgba(255, 255, 255, 0.3)",borderTop:"2px solid #fff",borderRadius:"50%",animation:"spin 1s linear infinite"}}),"login"===b?"Connexion...":"Inscription..."]}):"login"===b?"Se connecter":"S'inscrire"}),t("button",{type:"button",onClick:H,disabled:I,"aria-label":"Se connecter avec Google",role:"button",tabIndex:0,style:{width:"100%",padding:window.innerWidth<=768?"14px 20px":"14px 24px",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:window.innerWidth<=768?"12px":"16px",background:"rgba(255, 255, 255, 0.1)",color:"#fff",fontSize:window.innerWidth<=768?"16px":"18px",fontWeight:"600",cursor:I?"not-allowed":"pointer",transition:"all 0.2s ease",opacity:I?.6:1,minHeight:window.innerWidth<=768?"48px":"auto",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},onMouseEnter:e=>{I||(e.target.style.background="rgba(255, 255, 255, 0.2)")},onMouseLeave:e=>{e.target.style.background="rgba(255, 255, 255, 0.1)"},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||I||(e.preventDefault(),H())},children:I?i("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[t("div",{style:{width:"16px",height:"16px",border:"2px solid rgba(255, 255, 255, 0.3)",borderTop:"2px solid #fff",borderRadius:"50%",animation:"spin 1s linear infinite"}}),"Connexion..."]}):i(n,{children:[t("span",{style:{fontSize:window.innerWidth<=768?"18px":"20px"},children:"üîç"}),"Se connecter avec Google"]})}),"login"===b&&t("button",{type:"button",onClick:V,"aria-label":"Mot de passe oubli√©",role:"button",tabIndex:0,style:{background:"none",border:"none",color:"#1cc6ff",fontSize:window.innerWidth<=768?"14px":"16px",cursor:"pointer",textDecoration:"underline",transition:"all 0.2s ease",padding:window.innerWidth<=768?"8px":"12px",minHeight:window.innerWidth<=768?"44px":"auto"},onMouseEnter:e=>e.target.style.color="#009fff",onMouseLeave:e=>e.target.style.color="#1cc6ff",onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),V())},children:"Mot de passe oubli√© ?"})]})]})})}export{h as default};
